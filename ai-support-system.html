<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Customer Support Ticket System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 15px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: bold;
        }

        .tab:hover {
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 10px 10px 0 0;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.2);
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .ticket {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .ticket:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        .ticket-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .ticket-id {
            font-weight: bold;
            color: #2c3e50;
        }

        .category {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .category.technical { background: #e74c3c; color: white; }
        .category.billing { background: #f39c12; color: white; }
        .category.general { background: #3498db; color: white; }
        .category.urgent { background: #9b59b6; color: white; animation: pulse 2s infinite; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .suggested-response {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-top: 15px;
            border-radius: 0 10px 10px 0;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: 2px solid transparent;
            transition: border-color 0.3s ease, transform 0.3s ease;
        }

        .metric-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
        }

        .metric-value {
            font-size: 3em;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .metric-label {
            color: #666;
            margin-top: 10px;
            font-size: 1.1em;
        }

        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .processing-animation {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e0e0e0;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #c3e6cb;
            display: none;
        }

        @media (max-width: 768px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ¤– AI Support Ticket System</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('submit')">Submit Ticket</button>
            <button class="tab" onclick="showTab('queue')">Ticket Queue</button>
            <button class="tab" onclick="showTab('analytics')">Analytics Dashboard</button>
        </div>

        <!-- Submit Ticket Tab -->
        <div id="submit" class="tab-content active">
            <form id="ticketForm">
                <div class="form-group">
                    <label for="customerName">Customer Name:</label>
                    <input type="text" id="customerName" required>
                </div>
                
                <div class="form-group">
                    <label for="customerEmail">Email:</label>
                    <input type="email" id="customerEmail" required>
                </div>
                
                <div class="form-group">
                    <label for="subject">Subject:</label>
                    <input type="text" id="subject" required>
                </div>
                
                <div class="form-group">
                    <label for="description">Description:</label>
                    <textarea id="description" rows="6" required placeholder="Please describe your issue in detail..."></textarea>
                </div>
                
                <button type="submit" class="btn">ðŸš€ Submit Ticket</button>
            </form>
            
            <div class="processing-animation" id="processing">
                <div class="spinner"></div>
                <p>ðŸ¤– AI is analyzing your ticket...</p>
            </div>
            
            <div class="success-message" id="success">
                âœ… Ticket submitted successfully! AI has automatically categorized and routed your request.
            </div>
        </div>

        <!-- Ticket Queue Tab -->
        <div id="queue" class="tab-content">
            <h2>ðŸ“‹ Current Ticket Queue</h2>
            <div id="ticketList"></div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <h2>ðŸ“Š System Analytics</h2>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="totalTickets">0</div>
                    <div class="metric-label">Total Tickets</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="avgResponseTime">2.3s</div>
                    <div class="metric-label">Avg Response Time</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="accuracyRate">95%</div>
                    <div class="metric-label">AI Accuracy</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="timeSaved">8.2h</div>
                    <div class="metric-label">Time Saved Today</div>
                </div>
            </div>
            
            <div class="charts-container">
                <div class="chart-container">
                    <h3>Ticket Categories</h3>
                    <canvas id="categoryChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>Resolution Timeline</h3>
                    <canvas id="timelineChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let tickets = [];
        let ticketCounter = 1;
        let categoryChart, timelineChart;

        // categorization system
        const categoryKeywords = {
            technical: ['error', 'bug', 'crash', 'not working', 'broken', 'glitch', 'code', 'technical', 'system', 'server', 'database', 'api', 'integration', 'performance'],
            billing: ['payment', 'bill', 'invoice', 'charge', 'refund', 'subscription', 'price', 'cost', 'billing', 'card', 'money', 'account'],
            urgent: ['urgent', 'emergency', 'critical', 'immediately', 'asap', 'down', 'outage', 'security', 'hack', 'breach'],
            general: ['question', 'help', 'how to', 'information', 'support', 'general', 'inquiry']
        };

        const responseTemplates = {
            technical: "Thank you for reporting this technical issue. Our engineering team has been notified and will investigate immediately. We'll provide updates within 2 business hours. Ticket ID: #{ticketId}",
            billing: "Thank you for contacting us about your billing inquiry. Our billing department will review your account and respond within 1 business day. Reference: #{ticketId}",
            urgent: "ðŸš¨ URGENT: Your request has been escalated to our priority queue. A senior specialist will contact you within 30 minutes. Emergency Ticket: #{ticketId}",
            general: "Thank you for reaching out! Our support team will review your inquiry and provide assistance within 4 business hours. Ticket: #{ticketId}"
        };

        // AI categorization function
        async function categorizeTicket(subject, description) {
            let prompt = "There are 4 categories: general, billing, urgent and technical. Categorize the following message into one of those and give me only a one word response from one of the categories without any punctuation: ";
            prompt += description;
            const text = (subject + ' ' + description).toLowerCase();
            let scores = { technical: 0, billing: 0, urgent: 0, general: 0 };

            const response = await fetch('http://localhost:11434/api/generate', {
                method: 'POST',
                body: JSON.stringify({ model: "llama3.2", prompt: prompt, stream: false })
            });

            const llmData = await response.json();
            
            // Score based on keyword matches
            // for (let category in categoryKeywords) {
            //     categoryKeywords[category].forEach(keyword => {
            //         if (text.includes(keyword)) {
                        scores[llmData.response.toLowerCase()]++;
            //         }
            //     });
            // }
            
            // Return category with highest score
            return Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
        }

        // Generate suggested response
        function generateResponse(category, ticketId) {
            return responseTemplates[category].replace('#{ticketId}', ticketId);
        }

        // Show tab function
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'analytics') {
                setTimeout(updateCharts, 100);
            }
        }

        // Form submission handler
        document.getElementById('ticketForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Show processing animation
            document.getElementById('processing').style.display = 'block';
            
            setTimeout(async () => {
                const formData = {
                    id: `TKT-${String(ticketCounter).padStart(4, '0')}`,
                    customerName: document.getElementById('customerName').value,
                    customerEmail: document.getElementById('customerEmail').value,
                    subject: document.getElementById('subject').value,
                    description: document.getElementById('description').value,
                    timestamp: new Date(),
                    status: 'Open'
                };
                
                // AI categorization
                const category = await categorizeTicket(formData.subject, formData.description);
                formData.category = category;
                formData.suggestedResponse = generateResponse(category, formData.id);
                
                // Add to tickets array
                tickets.push(formData);
                ticketCounter++;
                
                // Hide processing, show success
                document.getElementById('processing').style.display = 'none';
                document.getElementById('success').style.display = 'block';
                
                // Reset form
                document.getElementById('ticketForm').reset();
                
                // Update displays
                updateTicketQueue();
                updateMetrics();
                
                setTimeout(() => {
                    document.getElementById('success').style.display = 'none';
                }, 3000);
                
            }, 2000); // Simulate AI processing time
        });

        // Update ticket queue display
        function updateTicketQueue() {
            const ticketList = document.getElementById('ticketList');
            ticketList.innerHTML = '';
            
            tickets.slice().reverse().forEach(ticket => {
                const ticketElement = document.createElement('div');
                ticketElement.className = 'ticket';
                ticketElement.innerHTML = `
                    <div class="ticket-header">
                        <span class="ticket-id">${ticket.id}</span>
                        <span class="category ${ticket.category}">${ticket.category}</span>
                    </div>
                    <h3>${ticket.subject}</h3>
                    <p><strong>Customer:</strong> ${ticket.customerName} (${ticket.customerEmail})</p>
                    <p><strong>Submitted:</strong> ${ticket.timestamp.toLocaleString()}</p>
                    <p><strong>Description:</strong> ${ticket.description}</p>
                    <div class="suggested-response">
                        <strong>ðŸ¤– AI Suggested Response:</strong><br>
                        ${ticket.suggestedResponse}
                    </div>
                `;
                ticketList.appendChild(ticketElement);
            });
        }

        // Update metrics
        function updateMetrics() {
            document.getElementById('totalTickets').textContent = tickets.length;
            
            // Calculate time saved (assume 5 min per ticket manually vs 10 seconds automated)
            const timeSaved = tickets.length * 4.83 / 60; // hours
            document.getElementById('timeSaved').textContent = timeSaved.toFixed(1) + 'h';
        }

        // Update charts
        function updateCharts() {
            updateCategoryChart();
            updateTimelineChart();
        }

        function updateCategoryChart() {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            
            if (categoryChart) {
                categoryChart.destroy();
            }
            
            const categoryCounts = { technical: 0, billing: 0, urgent: 0, general: 0 };
            tickets.forEach(ticket => {
                categoryCounts[ticket.category]++;
            });
            
            categoryChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Technical', 'Billing', 'Urgent', 'General'],
                    datasets: [{
                        data: [categoryCounts.technical, categoryCounts.billing, categoryCounts.urgent, categoryCounts.general],
                        backgroundColor: ['#e74c3c', '#f39c12', '#9b59b6', '#3498db'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function updateTimelineChart() {
            const ctx = document.getElementById('timelineChart').getContext('2d');
            
            if (timelineChart) {
                timelineChart.destroy();
            }
            
            // Generate sample data for timeline
            const hours = [];
            const ticketCounts = [];
            
            for (let i = 0; i < 24; i++) {
                hours.push(i + ':00');
                ticketCounts.push(Math.floor(Math.random() * 10) + tickets.length / 24);
            }
            
            timelineChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: hours,
                    datasets: [{
                        label: 'Tickets per Hour',
                        data: ticketCounts,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Initialize with sample data
        function initializeSampleData() {
            const sampleTickets = [
                {
                    id: 'TKT-0001',
                    customerName: 'John Smith',
                    customerEmail: 'john@example.com',
                    subject: 'Website not loading properly',
                    description: 'The website crashes when I try to access my dashboard. Getting error 500.',
                    category: 'technical',
                    timestamp: new Date(Date.now() - 3600000),
                    status: 'Open',
                    suggestedResponse: 'Thank you for reporting this technical issue. Our engineering team has been notified and will investigate immediately. We\'ll provide updates within 2 business hours. Ticket ID: TKT-0001'
                },
                {
                    id: 'TKT-0002',
                    customerName: 'Sarah Johnson',
                    customerEmail: 'sarah@example.com',
                    subject: 'Billing question about subscription',
                    description: 'I was charged twice for my monthly subscription. Please help me get a refund.',
                    category: 'billing',
                    timestamp: new Date(Date.now() - 1800000),
                    status: 'Open',
                    suggestedResponse: 'Thank you for contacting us about your billing inquiry. Our billing department will review your account and respond within 1 business day. Reference: TKT-0002'
                }
            ];
            
            tickets = sampleTickets;
            ticketCounter = 3;
            updateTicketQueue();
            updateMetrics();
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeSampleData();
            updateCharts();
        });
    </script>
</body>
</html>